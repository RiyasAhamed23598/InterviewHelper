---
import QuizComponent from './QuizComponent';

const { topic } = Astro.props;

// Function to convert topic name to filename format
const getQuestionFileName = (topic: string) => {
  // Remove .mdx extension if present
  const baseName = topic.replace(/\.mdx$/, '');
  return baseName + '.json';
};

// Dynamically import the questions based on the topic
let questions = [];

try {
  // First try to load from src directory
  try {
    const srcQuestionsFile = `../mcq_generator/questions/${getQuestionFileName(topic)}`;
    console.log(srcQuestionsFile);
    const questionsModule = await import(srcQuestionsFile, { assert: { type: 'json' } });
    questions = questionsModule.default;
  } catch (srcError) {
    // If that fails, try to load from public directory
    // after build it get stored inside the dist so use the dist path
    const publicQuestionsFile = `/dist/questions/${getQuestionFileName(topic)}`;
    console.log(publicQuestionsFile);
    const response = await fetch(publicQuestionsFile);
    
    if (response.ok) {
      questions = await response.json();
    } else {
      throw new Error(`Failed to fetch questions from public directory`);
    }
  }
} catch (error) {
  console.warn(`Questions file for topic '${topic}' not found. Using empty questions array.`);
  questions = [];
}

const formatTopicName = (topic: string) => {
  // Remove .mdx extension if present
  const baseName = topic.replace(/\.mdx$/, '');
  
  // Convert kebab-case to Title Case
  return baseName
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

const topicName = formatTopicName(topic);
---

<div class="quiz-container">
  <QuizComponent client:load questions={questions} topicName={topicName} />
</div>

<style>
  .quiz-container {
    margin-top: 2rem;
  }
</style>
