---
import { GA_MEASUREMENT_ID } from '../config';
---

<!-- Google Analytics 4 Script -->
{GA_MEASUREMENT_ID && (
  <Fragment>
    <script 
      type="text/partytown"
      src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}
    ></script>
    <script type="text/partytown" define:vars={{ GA_MEASUREMENT_ID }}>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', GA_MEASUREMENT_ID, {
        send_page_view: false
      });
      document.addEventListener('astro:after-swap', () => {
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href,
          page_path: window.location.pathname
        });
      });
    </script>
  </Fragment>
)}
